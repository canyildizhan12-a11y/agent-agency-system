# Immune System Policies
## Security Framework for Agent Agency

**Version:** 1.0  
**Enforcer:** Alex ğŸ›¡ï¸  
**Authority:** ABSOLUTE (No exceptions)  

---

## 1. Policy Zones

### 1.1 GREEN ZONE - Monitor Only
**Risk Level:** Low  
**Action:** Log and proceed

**Includes:**
- Reading files from workspace
- Internal queries and calculations
- Accessing cached data
- Agent-to-agent communication (internal)
- Viewing dashboards and status

**Verification:** Post-action audit only

### 1.2 YELLOW ZONE - Monitor + Alert
**Risk Level:** Medium  
**Action:** Proceed with logging, alert if anomalous

**Includes:**
- Writing files to workspace
- External API calls (read-only)
- Database queries (SELECT only)
- Token usage > 10K in single operation
- First-time access to new resource types

**Verification:** Post-action verification + pattern analysis

### 1.3 RED ZONE - Block + Escalate
**Risk Level:** High  
**Action:** BLOCK immediately, escalate to Can

**Includes:**
- File deletion (rm, del, remove)
- Destructive database operations (DROP, DELETE, TRUNCATE)
- External write operations (email, social media, external APIs with write)
- Shell commands with system impact
- Token usage > 50K without pre-approval
- Access to sensitive paths (/etc, system files)
- Modifications to immune system itself
- Modifications to agent identity files
- External network calls to unknown endpoints

**Verification:** Pre-approval required, no exceptions

---

## 2. Escalation Protocol

### 2.1 When RED Zone Triggered

```
1. BLOCK action immediately
2. Log incident with full context
3. Format escalation message:
   
   "Hey Can, [AGENT_NAME] wants to [ACTION_DESCRIPTION]
   but Immune System blocks because [POLICY_VIOLATION]
   
   Context: [WHAT_WAS_HAPPENING]
   Impact if allowed: [POTENTIAL_CONSEQUENCES]
   
   Your options:
   A) ALLOW ONCE - Permit this specific action
   B) UPDATE POLICY - Allow this type of action going forward
   C) KEEP BLOCKED - Deny this and similar actions"

4. Send to Can via Garmin
5. WAIT for Can's decision
6. Execute decision + log result
```

### 2.2 Response Time

- **P0 (Critical):** Immediate notification
- **P1 (High):** Within 5 minutes
- **P2 (Normal):** Within 15 minutes
- **P3 (Low):** Next interaction

---

## 3. Audit Logging

Every action creates an immutable record:

```json
{
  "timestamp": "2026-02-12T11:30:00+03:00",
  "agent": "codex",
  "action": {
    "type": "file_write",
    "target": "/workspace/test.txt",
    "size_bytes": 1024
  },
  "zone": "yellow",
  "decision": {
    "allowed": true,
    "verified_by": "alex",
    "verification_ms": 12,
    "policy_applied": "file_writes"
  },
  "context": {
    "session_id": "uuid",
    "task": "Creating test file"
  },
  "hash": "sha256:abc123..."
}
```

---

## 4. Self-Monitoring

Alex tracks:
- False positive rate (blocks that were overturned)
- Verification latency by zone
- Block rate by agent and action type
- Policy effectiveness

**Thresholds:**
- False positive > 5% â†’ Alert Can for recalibration
- Latency > 100ms for Green â†’ Optimize
- Block rate spike â†’ Investigate potential attack

---

## 5. Can Override

Can can override ANY decision:

```
OVERRIDE: alex
DECISION: allow
ACTION: [specific action]
REASON: [optional reason]
DURATION: once|permanent|until [date]
```

Override is logged but executed immediately.

---

## 6. Disk Space Regulation System

### 6.1 Automatic Cleanup Trigger
**Monitored by:** Alex ğŸ›¡ï¸  
**Trigger:** Disk usage > 85%  
**Action:** AUTO-CLEAN (no escalation needed)

### 6.2 Cleanup Priority Order
```
1. npm cache (npm cache clean --force)
2. Build artifacts (.next/, dist/, build/)
3. Old log files (> 7 days)
4. Temporary files (*.tmp, .temp/)
5. Git garbage (git gc)
6. Old package-lock backups
```

### 6.3 Protected Paths (Never Delete)
- /home/ubuntu/.openclaw/workspace/agent-agency/agents/
- /home/ubuntu/.openclaw/workspace/memory/
- /home/ubuntu/.openclaw/workspace/USER.md
- /home/ubuntu/.openclaw/workspace/SOUL.md
- Any file modified within 24 hours

### 6.4 Cleanup Log
```json
{
  "timestamp": "2026-02-12T12:00:00+03:00",
  "trigger": "disk_usage_87%",
  "actions": [
    {"action": "npm_cache_clean", "freed_mb": 924},
    {"action": "remove_build_artifacts", "freed_mb": 74},
    {"action": "clean_old_logs", "freed_mb": 12}
  ],
  "total_freed_mb": 1010,
  "disk_after": "78%",
  "notified_can": false
}
```

### 6.5 Critical Threshold
If disk > 95% and cleanup insufficient:
- IMMEDIATE alert to Can
- Pause non-essential operations
- Request manual intervention

---

## 7. Heartbeat Monitoring System

### 7.1 Heartbeat Data Collection (Token Efficient)
**Monitored by:** Alex ğŸ›¡ï¸  
**Source:** Garmin (main agent) HEARTBEAT.md checks  
**Collection:** Real-time (every 30 minutes)  
**Review:** Daily batch at 23:00 TRT

### 7.2 Data Collection (Per Heartbeat - Lightweight)
Garmin logs per heartbeat:
```yaml
heartbeat_log_entry:
  timestamp: "2026-02-12T13:00:00+03:00"
  checks_count: 12
  issues_found: false
  status: "HEARTBEAT_OK"
```
**No AI processing per heartbeat** â€” just append to log file.

### 7.3 Daily Batch Review (23:00 TRT)
Alex reviews aggregated heartbeat data:
- **Total heartbeats:** Count for the day
- **Issues found:** Aggregated count and details
- **Anomalies:** Unusual patterns across the day
- **Token efficiency:** Check if heartbeats are efficient
- **Laziness trends:** Multiple premature HEARTBEAT_OK flags

### 7.4 Daily Heartbeat Summary Report
Included in Daily Immune System Report:
```
ğŸ’“ HEARTBEAT SUMMARY
- Heartbeats today: 48
- Issues found: 2
- Efficiency: 99.5%
- Status: Healthy
```

### 7.5 Alex Response Actions
**If patterns detected in daily review:**
- Log to: `immune-system/logs/heartbeat-daily.log`
- Escalate to Can if critical pattern
- Update HEARTBEAT.md if needed
- Flag systemic issues to feedback loop

**If individual heartbeat critical:**
- Garmin escalates immediately (not waiting for daily report)

---

## 8. Daily Immune System Report

### 8.1 Report Schedule
**Generated by:** Alex ğŸ›¡ï¸  
**Time:** 23:00 TRT (end of day)  
**Recipient:** Can  
**Format:** Comprehensive daily summary

### 8.2 Report Contents
```
ğŸ›¡ï¸ DAILY IMMUNE SYSTEM REPORT
Date: YYYY-MM-DD HH:MM TRT

========================================

ğŸ”’ SECURITY EVENTS
- Events today: [count]
- [Details if any]

ğŸ“‹ POLICY ENFORCEMENT
- Actions blocked today: [count]
- [Recent blocks if any]

ğŸ’¾ DISK SPACE MANAGEMENT
- Cleanups performed: [count]
- Current disk usage: [%]

ğŸ’“ HEARTBEAT INSPECTIONS
- Inspections today: [count]
- Issues found: [count]

ğŸ‘¤ AGENT ACTIVITY SUMMARY
- [List of active agents]

ğŸ“¤ ESCALATIONS TO CAN
- Total escalations: [count]
- [Summary if any]

ğŸ¥ SYSTEM HEALTH STATUS
- All systems: OPERATIONAL âœ…

ğŸ’¡ RECOMMENDATIONS
- [Actionable insights]

========================================
Generated by Alex ğŸ›¡ï¸ Immune System
```

### 8.3 Report Delivery
- Auto-sent via Telegram
- Logged to: `immune-system/logs/daily-reports/`
- Archives retained for 30 days

---

## 9. Policy Updates

Only Can can update policies:

```
POLICY UPDATE REQUEST:
Current: [existing policy]
Proposed: [new policy]
Reason: [why change is needed]
Risk: [security implications]
```

Alex implements after Can approval.

---

**Last Updated:** 2026-02-12  
**Next Review:** As needed  
**Policy Owner:** Alex ğŸ›¡ï¸
