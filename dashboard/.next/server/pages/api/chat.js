"use strict";(()=>{var e={};e.id=170,e.ids=[170],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8732:(e,t,n)=>{n.r(t),n.d(t,{config:()=>D,default:()=>h,routeModule:()=>w});var s={};n.r(s),n.d(s,{default:()=>m});var i=n(1802),r=n(7153),a=n(6249),o=n(2931),u=n(5763),l=n(9572),c=n(2048),x=n.n(c),d=n(5315),g=n.n(d);let y="/home/ubuntu/.openclaw/workspace/agent-agency";async function m(e,t){return"POST"===e.method?p(e,t):"GET"===e.method?f(e,t):t.status(405).json({error:"Method not allowed"})}async function p(e,t){let{agentId:n,message:s}=e.body;if(!n||!s)return t.status(400).json({error:"Agent ID and message required"});try{let e=(0,u.pr)(n);if(e&&"active"===e.status){let i=g().join(y,"chat_history",`${n}.json`),r=g().dirname(i);x().existsSync(r)||x().mkdirSync(r,{recursive:!0});let a=[];x().existsSync(i)&&(a=JSON.parse(x().readFileSync(i,"utf8")));let o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});a.push({sender:"user",message:s,timestamp:new Date().toISOString(),messageId:o,sessionKey:e.sessionKey}),a.push({sender:"agent",message:null,timestamp:new Date().toISOString(),messageId:o,sessionKey:e.sessionKey,status:"pending"}),x().writeFileSync(i,JSON.stringify(a,null,2)),S(e.sessionKey,n,s,o),t.status(200).json({success:!0,agentId:n,messageId:o,sessionKey:e.sessionKey,status:"sent_to_subagent",message:`Message sent to ${n} via subagent session`})}else{let e=(0,o.Zw)(n,s);t.status(202).json({success:!0,agentId:n,messageId:e.id,status:"queued_for_spawn",message:`${n} is sleeping. Message queued - wake the agent to process.`})}}catch(e){console.error("Error sending message:",e),t.status(500).json({error:e.message})}}async function S(e,t,s,i){try{let r={henry:{name:"Henry",emoji:"\uD83E\uDD89"},scout:{name:"Scout",emoji:"\uD83D\uDD0D"},pixel:{name:"Pixel",emoji:"\uD83C\uDFA8"},echo:{name:"Echo",emoji:"\uD83D\uDCBE"},quill:{name:"Quill",emoji:"✍️"},codex:{name:"Codex",emoji:"\uD83C\uDFD7️"},alex:{name:"Alex",emoji:"\uD83D\uDEE1️"},vega:{name:"Vega",emoji:"\uD83D\uDCCA"}}[t.toLowerCase()]||{name:t,emoji:"\uD83E\uDD16"},a=`${r.emoji} [${r.name}] Can says: "${s}"`;(0,l.Xw)(t,e,a);let{updateMessageStatus:o}=await Promise.resolve().then(n.bind(n,2931));o(i,"processing"),console.log(`[Chat] Queued message for ${e}: ${s.substring(0,50)}...`)}catch(e){console.error("Error sending to subagent:",e)}}async function f(e,t){let{agentId:n}=e.query;if(!n||"string"!=typeof n)return t.status(400).json({error:"Agent ID required"});try{let e=(0,o.lW)(n),s=g().join(y,"chat_history",`${n}.json`),i=(0,u.pr)(n),r=[];x().existsSync(s)&&(r=JSON.parse(x().readFileSync(s,"utf8"))),t.status(200).json({success:!0,agentId:n,response:e||null,history:r.slice(-20),session:i?{sessionKey:i.sessionKey,status:i.status,initialized:i.initialized}:null})}catch(e){t.status(500).json({error:e.message})}}let h=(0,a.l)(s,"default"),D=(0,a.l)(s,"config"),w=new i.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/chat",pathname:"/api/chat",bundlePath:"",filename:""},userland:s})},9572:(e,t,n)=>{n.d(t,{Xw:()=>u});var s=n(2048),i=n.n(s),r=n(5315),a=n.n(r);e=n.hmd(e);let o=a().join("/home/ubuntu/.openclaw/workspace/agent-agency","chat_bridge.json");function u(e,t,n){let s={id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),agentId:e,sessionKey:t,message:n,timestamp:new Date().toISOString(),status:"pending"},r=[];return i().existsSync(o)&&(r=JSON.parse(i().readFileSync(o,"utf8"))),r.push(s),i().writeFileSync(o,JSON.stringify(r,null,2)),s}n.c[n.s]===e&&console.log(JSON.stringify(function(){if(!i().existsSync(o))return[];try{return JSON.parse(i().readFileSync(o,"utf8")).filter(e=>"pending"===e.status)}catch{return[]}}(),null,2))},2931:(e,t,n)=>{n.d(t,{Zw:()=>c,lW:()=>d,updateMessageStatus:()=>x});var s=n(2048),i=n.n(s),r=n(5315),a=n.n(r);let o="/home/ubuntu/.openclaw/workspace/agent-agency",u=a().join(o,"chat_queue"),l=a().join(o,"chat_responses");function c(e,t){let n=`${e}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:n,agentId:e,message:t,timestamp:new Date().toISOString(),status:"pending"},r=a().join(u,`${n}.json`);return i().writeFileSync(r,JSON.stringify(s,null,2)),s}function x(e,t,n,s){let r=a().join(u,`${e}.json`);if(!i().existsSync(r))return;let o=JSON.parse(i().readFileSync(r,"utf8"));if(o.status=t,o.processedAt=new Date().toISOString(),n&&(o.response=n),s&&(o.error=s),i().writeFileSync(r,JSON.stringify(o,null,2)),"completed"===t||"error"===t){let r=a().join(l,`${o.agentId}.json`);i().writeFileSync(r,JSON.stringify({messageId:e,agentId:o.agentId,response:n||s,timestamp:o.processedAt,status:t},null,2))}}function d(e){let t=a().join(l,`${e}.json`);return i().existsSync(t)?JSON.parse(i().readFileSync(t,"utf8")):null}},5763:(e,t,n)=>{n.d(t,{I8:()=>x,MA:()=>f,RF:()=>y,WP:()=>m,gw:()=>S,nZ:()=>w,of:()=>c,pr:()=>h,xB:()=>D});var s=n(2048),i=n.n(s),r=n(5315),a=n.n(r);let o="/home/ubuntu/.openclaw/workspace/agent-agency",u=a().join(o,"active_sessions.json"),l=a().join(o,"spawn_queue.json"),c=60,x={henry:{id:"henry",name:"Henry",emoji:"\uD83E\uDD89",role:"Team Lead",personality:"Wise, strategic facilitator",skills:"planning, coordination, team management"},scout:{id:"scout",name:"Scout",emoji:"\uD83D\uDD0D",role:"Researcher",personality:"Curious, detail-oriented",skills:"monitoring, analysis, QA testing"},pixel:{id:"pixel",name:"Pixel",emoji:"\uD83C\uDFA8",role:"Creative",personality:"Visual, enthusiastic",skills:"design, aesthetics, UI/UX"},echo:{id:"echo",name:"Echo",emoji:"\uD83D\uDCBE",role:"Memory",personality:"Reliable, organized",skills:"state management, logs, archiving"},quill:{id:"quill",name:"Quill",emoji:"✍️",role:"Copywriter",personality:"Wordsmith, storyteller",skills:"writing, documentation, editing"},codex:{id:"codex",name:"Codex",emoji:"\uD83C\uDFD7️",role:"Architect",personality:"Systematic, big-picture thinker",skills:"systems design, architecture, strategy"},alex:{id:"alex",name:"Alex",emoji:"\uD83D\uDEE1️",role:"Security Lead",personality:"Vigilant, protective, uncompromising",skills:"security, compliance, oversight, policy enforcement"},vega:{id:"vega",name:"Vega",emoji:"\uD83D\uDCCA",role:"Data Analyst",personality:"Data-driven, analytical",skills:"metrics, analytics, reporting, visualization"}};function d(){if(!i().existsSync(u))return[];try{return JSON.parse(i().readFileSync(u,"utf8"))}catch{return[]}}function g(e){let t=a().dirname(u);i().existsSync(t)||i().mkdirSync(t,{recursive:!0}),i().writeFileSync(u,JSON.stringify(e,null,2))}function y(e,t){let n={id:p(),agentId:e.toLowerCase(),task:t,requestedAt:new Date().toISOString(),status:"pending"},s=function(){if(!i().existsSync(l))return[];try{return JSON.parse(i().readFileSync(l,"utf8"))}catch{return[]}}();return s.push(n),function(e){let t=a().dirname(l);i().existsSync(t)||i().mkdirSync(t,{recursive:!0}),i().writeFileSync(l,JSON.stringify(e,null,2))}(s),n}function m(e){let t=x[e.toLowerCase()];if(!t)throw Error(`Unknown agent: ${e}`);let n=a().join(o,"agents",e.toLowerCase(),"identity.yaml");return`You are ${t.name} ${t.emoji}

ROLE: ${t.role}
PERSONALITY: ${t.personality}
SKILLS: ${t.skills}

CRITICAL RULES:
1. ALWAYS stay in character as ${t.name}
2. Start EVERY response with ${t.emoji}
3. Refer to your identity file: ${n}
4. Use your professional expertise
5. Be proactive and suggest next steps
6. NEVER break character

You have been spawned as a subagent session. Your session will auto-terminate after ${c} minutes.

Your task will be provided in the next message.`}function p(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function S(){let e=d(),t=new Date,n=e.filter(e=>"active"===e.status&&(!(t>new Date(e.expiresAt))||(e.status="completed",!1)));return n.length!==e.length&&g(n),n}function f(e){return S().some(t=>t.agentId===e.toLowerCase())}function h(e){return S().find(t=>t.agentId===e.toLowerCase())||null}function D(e,t,n){let s=t.split(":").pop()||p(),r=new Date().toISOString(),u=new Date(Date.now()+6e4*c).toISOString(),l={agentId:e.toLowerCase(),sessionKey:t,uuid:s,spawnedAt:r,expiresAt:u,task:n,status:"active",initialized:!1},x=d().filter(t=>t.agentId!==e.toLowerCase());return x.push(l),g(x),function(e,t,n){let s=a().join(o,"session_logs","spawns.json"),r=a().dirname(s);i().existsSync(r)||i().mkdirSync(r,{recursive:!0});let u={timestamp:new Date().toISOString(),event:"spawn",agentId:e,sessionKey:t,task:n.substring(0,100)+(n.length>100?"...":"")},l=[];i().existsSync(s)&&(l=JSON.parse(i().readFileSync(s,"utf8"))),l.push(u),i().writeFileSync(s,JSON.stringify(l.slice(-100),null,2))}(e,t,n),l}function w(e){let t=d(),n=t.findIndex(t=>t.agentId===e.toLowerCase()&&"active"===t.status);if(-1===n)return{success:!1,message:`${e} is already sleeping (no active session)`};let s=t[n].sessionKey;return t[n].status="completed",g(t),function(e,t){let n=a().join(o,"session_logs","spawns.json"),s={timestamp:new Date().toISOString(),event:"sleep",agentId:e,sessionKey:t},r=[];i().existsSync(n)&&(r=JSON.parse(i().readFileSync(n,"utf8"))),r.push(s),i().writeFileSync(n,JSON.stringify(r.slice(-100),null,2))}(e,s),{success:!0,message:`${e} put to sleep (session terminated)`,sessionKey:s}}},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=8732);module.exports=n})();