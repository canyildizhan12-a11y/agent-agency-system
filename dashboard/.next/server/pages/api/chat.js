"use strict";(()=>{var e={};e.id=170,e.ids=[170],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8732:(e,t,n)=>{n.r(t),n.d(t,{config:()=>D,default:()=>j,routeModule:()=>P});var s={};n.r(s),n.d(s,{default:()=>p});var r=n(1802),o=n(7153),a=n(6249),i=n(1282),u=n(2048),l=n.n(u),c=n(5315),m=n.n(c);let d="/home/ubuntu/.openclaw/workspace/agent-agency",x={henry:{name:"Henry",emoji:"\uD83E\uDD89"},scout:{name:"Scout",emoji:"\uD83D\uDD0D"},pixel:{name:"Pixel",emoji:"\uD83C\uDFA8"},echo:{name:"Echo",emoji:"\uD83D\uDCBE"},quill:{name:"Quill",emoji:"✍️"},codex:{name:"Codex",emoji:"\uD83C\uDFD7️"},alex:{name:"Alex",emoji:"\uD83D\uDEE1️"},vega:{name:"Vega",emoji:"\uD83D\uDCCA"}};async function p(e,t){return"POST"===e.method?g(e,t):"GET"===e.method?f(e,t):t.status(405).json({error:"Method not allowed"})}async function g(e,t){let{agentId:n,message:s}=e.body;if(!n||!s)return t.status(400).json({error:"Agent ID and message required"});let r=x[n.toLowerCase()];if(!r)return t.status(400).json({error:`Unknown agent: ${n}`});try{let e=y(n);if(!e||"active"!==e.status)return t.status(400).json({error:`${r.name} is sleeping. Wake them up first.`,status:"sleeping"});let o="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),a=new Date().toISOString(),u=m().join(d,"chat_history",`${n}.json`),c=h(u);c.push({sender:"user",message:s,timestamp:a,messageId:o,sessionKey:e.sessionKey});let x=`${r.emoji} [${r.name}] Can says: "${s}"`,p=e.sessionKey.split(":").pop();console.log(`[Chat] Calling openclaw agent --session-id ${p} -m "${s.substring(0,50)}..."`);let g=await new Promise((e,t)=>{try{console.log(`[CLI] openclaw agent --session-id ${p} -m "${x.substring(0,50)}..."`);let t=(0,i.execSync)(`openclaw agent --session-id ${p} --message "${x.replace(/"/g,'\\"')}" --json`,{encoding:"utf8",timeout:7e4,cwd:"/home/ubuntu/.openclaw/workspace"}),n=JSON.parse(t);if("ok"===n.status&&n.result&&n.result.payloads){let t=n.result.payloads[0]?.text||"No response";e(t)}else e("Error: Unexpected response format")}catch(e){console.error("CLI error:",e),t(Error(`CLI failed: ${e.message}`))}});c.push({sender:"agent",message:g,timestamp:new Date().toISOString(),messageId:o,sessionKey:e.sessionKey,status:"completed"}),function(e,t){let n=m().dirname(e);l().existsSync(n)||l().mkdirSync(n,{recursive:!0}),l().writeFileSync(e,JSON.stringify(t,null,2))}(u,c),t.status(200).json({success:!0,agentId:n,agentName:r.name,agentEmoji:r.emoji,message:s,response:g,sessionKey:e.sessionKey,timestamp:new Date().toISOString()})}catch(e){console.error("Error in chat:",e),t.status(500).json({error:e.message,details:"Failed to process message"})}}async function f(e,t){let{agentId:n}=e.query;if(!n||"string"!=typeof n)return t.status(400).json({error:"Agent ID required"});let s=h(m().join(d,"chat_history",`${n}.json`)),r=y(n);t.status(200).json({success:!0,agentId:n,history:s.slice(-50),session:r})}function y(e){let t=m().join(d,"active_sessions.json");if(!l().existsSync(t))return null;try{return JSON.parse(l().readFileSync(t,"utf8")).find(t=>t.agentId===e.toLowerCase()&&"active"===t.status)}catch{return null}}function h(e){if(!l().existsSync(e))return[];try{return JSON.parse(l().readFileSync(e,"utf8"))}catch{return[]}}let j=(0,a.l)(s,"default"),D=(0,a.l)(s,"config"),P=new r.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/chat",pathname:"/api/chat",bundlePath:"",filename:""},userland:s})},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=8732);module.exports=n})();