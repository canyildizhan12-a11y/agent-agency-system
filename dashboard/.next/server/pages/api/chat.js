"use strict";(()=>{var e={};e.id=170,e.ids=[170],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8732:(e,t,n)=>{n.r(t),n.d(t,{config:()=>j,default:()=>w,routeModule:()=>$});var s={};n.r(s),n.d(s,{default:()=>m});var r=n(1802),i=n(7153),o=n(6249),a=n(2931),l=n(4614),u=n(2048),c=n.n(u),g=n(5315),p=n.n(g);let d="/home/ubuntu/.openclaw/workspace/agent-agency";async function m(e,t){return"POST"===e.method?y(e,t):"GET"===e.method?S(e,t):t.status(405).json({error:"Method not allowed"})}async function y(e,t){let{agentId:n,message:s}=e.body;if(!n||!s)return t.status(400).json({error:"Agent ID and message required"});try{let e=(0,a.Zw)(n,s),r=p().join(d,"chat_history",`${n}.json`),i=p().dirname(r);c().existsSync(i)||c().mkdirSync(i,{recursive:!0});let o=[];c().existsSync(r)&&(o=JSON.parse(c().readFileSync(r,"utf8"))),o.push({sender:"user",message:s,timestamp:new Date().toISOString(),queuedId:e.id}),o.push({sender:"agent",message:null,timestamp:new Date().toISOString(),queuedId:e.id,status:"pending"}),c().writeFileSync(r,JSON.stringify(o,null,2)),f(n,s,e.id),t.status(200).json({success:!0,agentId:n,messageId:e.id,status:"pending",message:"Message queued for processing"})}catch(e){console.error("Error queuing message:",e),t.status(500).json({error:e.message})}}async function S(e,t){let{agentId:n}=e.query;if(!n||"string"!=typeof n)return t.status(400).json({error:"Agent ID required"});try{let e=(0,a.lW)(n),s=p().join(d,"chat_history",`${n}.json`),r=[];c().existsSync(s)&&(r=JSON.parse(c().readFileSync(s,"utf8"))),t.status(200).json({success:!0,agentId:n,response:e||null,history:r.slice(-20)})}catch(e){t.status(500).json({error:e.message})}}async function f(e,t,s){let{updateMessageStatus:r}=await Promise.resolve().then(n.bind(n,2931));try{r(s,"processing");let n=await (0,l._)(e,t);r(s,"completed",n.output||n.message);let i=p().join(d,"chat_history",`${e}.json`);if(c().existsSync(i)){let e=JSON.parse(c().readFileSync(i,"utf8")),t=e.find(e=>e.queuedId===s&&"agent"===e.sender);t&&(t.message=n.output||n.message,t.status="completed",c().writeFileSync(i,JSON.stringify(e,null,2)))}await h(e,t,n.output||n.message)}catch(e){console.error(`Error processing message ${s}:`,e),r(s,"error",void 0,e.message)}}async function h(e,t,n){let s=p().join(d,"token_logs",`${new Date().toISOString().split("T")[0]}.json`),r={timestamp:new Date().toISOString(),agentId:e,inputTokens:Math.ceil(t.length/4),outputTokens:Math.ceil((n?.length||0)/4),totalTokens:Math.ceil((t.length+(n?.length||0))/4)},i=[];c().existsSync(s)&&(i=JSON.parse(c().readFileSync(s,"utf8"))),i.push(r),c().writeFileSync(s,JSON.stringify(i,null,2))}let w=(0,o.l)(s,"default"),j=(0,o.l)(s,"config"),$=new r.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/chat",pathname:"/api/chat",bundlePath:"",filename:""},userland:s})},2931:(e,t,n)=>{n.d(t,{Zw:()=>c,lW:()=>p,updateMessageStatus:()=>g});var s=n(2048),r=n.n(s),i=n(5315),o=n.n(i);let a="/home/ubuntu/.openclaw/workspace/agent-agency",l=o().join(a,"chat_queue"),u=o().join(a,"chat_responses");function c(e,t){let n=`${e}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,s={id:n,agentId:e,message:t,timestamp:new Date().toISOString(),status:"pending"},i=o().join(l,`${n}.json`);return r().writeFileSync(i,JSON.stringify(s,null,2)),s}function g(e,t,n,s){let i=o().join(l,`${e}.json`);if(!r().existsSync(i))return;let a=JSON.parse(r().readFileSync(i,"utf8"));if(a.status=t,a.processedAt=new Date().toISOString(),n&&(a.response=n),s&&(a.error=s),r().writeFileSync(i,JSON.stringify(a,null,2)),"completed"===t||"error"===t){let i=o().join(u,`${a.agentId}.json`);r().writeFileSync(i,JSON.stringify({messageId:e,agentId:a.agentId,response:n||s,timestamp:a.processedAt,status:t},null,2))}}function p(e){let t=o().join(u,`${e}.json`);return r().existsSync(t)?JSON.parse(r().readFileSync(t,"utf8")):null}},4614:(e,t,n)=>{n.d(t,{uF:()=>w,Uf:()=>j,r9:()=>h,BZ:()=>S,_:()=>y});let s=require("child_process");var r=n(2048),i=n.n(r),o=n(5315),a=n.n(o);let l="/home/ubuntu/.openclaw/workspace",u=a().join(l,"agent-agency"),c=a().join(u,"session_cache");i().existsSync(c)||i().mkdirSync(c,{recursive:!0});let g={henry:{name:"Henry",emoji:"\uD83E\uDD89",role:"Team Lead",personality:"Wise, strategic facilitator",skills:"planning, coordination"},scout:{name:"Scout",emoji:"\uD83D\uDD0D",role:"Researcher",personality:"Curious, detail-oriented",skills:"monitoring, analysis"},pixel:{name:"Pixel",emoji:"\uD83C\uDFA8",role:"Creative",personality:"Visual, enthusiastic",skills:"design, aesthetics"},echo:{name:"Echo",emoji:"\uD83D\uDCBE",role:"Memory",personality:"Practical, efficient",skills:"state management, logs"},quill:{name:"Quill",emoji:"✍️",role:"Copywriter",personality:"Wordsmith, storyteller",skills:"writing, content"},codex:{name:"Codex",emoji:"\uD83C\uDFD7️",role:"Architect",personality:"Big-picture thinker",skills:"systems, strategy"},alex:{name:"Alex",emoji:"\uD83D\uDEE1️",role:"Security Lead",personality:"Vigilant, protective",skills:"security, compliance, oversight"},vega:{name:"Vega",emoji:"\uD83D\uDCCA",role:"Data Analyst",personality:"Data-driven, analytical",skills:"metrics, analytics, reporting"}},p={};function d(e,t){return`[${e.emoji} ${e.name}|${e.role}] ${e.personality}. Skills: ${e.skills}. RULES: Stay in character. Start with ${e.emoji}. TASK: ${t}`}function m(e,t){return`You are ${e.name}, ${e.role} ${e.emoji}

PERSONALITY: ${e.personality}
EXPERTISE: ${e.skills}

CRITICAL RULES:
1. ALWAYS stay in character as ${e.name}
2. Start EVERY response with ${e.emoji}
3. Use your professional expertise
4. Be proactive and suggest next steps
5. NEVER break character

[TASK FROM CAN via AGENCY DASHBOARD]
${t}

Execute this task as ${e.name}. Provide your response in character.`}async function y(e,t){let n=g[e.toLowerCase()];if(!n)throw Error(`Unknown agent: ${e}`);let s=d(n,t);return f(e,n,s,t)}async function S(e,t){let n=g[e.toLowerCase()];if(!n)throw Error(`Unknown agent: ${e}`);let s=m(n,t);return f(e,n,s,t)}async function f(e,t,n,r){let o=`/tmp/agent-task-${e}-${Date.now()}.txt`;i().writeFileSync(o,n);try{console.log(`[Agent Agency] Spawning ${t.name} for task...`);let c=function(e){let t=p[e.toLowerCase()];if(t&&Date.now()-t.lastUsed<3e5)try{return process.kill(t.pid,0),{pid:t.pid,sessionId:t.sessionId}}catch{delete p[e.toLowerCase()]}return null}(e);c&&console.log(`[Agent Agency] Using cached session for ${t.name}`);let g=Date.now(),d=n.replace(/"/g,'\\"').replace(/\n/g," "),m=(0,s.execSync)(`cd ${l} && openclaw agent --agent ${e} -m "${d}" 2>&1`,{encoding:"utf8",timeout:12e4,env:{...process.env,OPENCLAW_WORKSPACE:l}}),y=Date.now()-g;return i().unlinkSync(o),function(e,t,n){let s=a().join(u,"sleeping_agents",`${e.toLowerCase()}.json`);if(i().existsSync(s)){let e=JSON.parse(i().readFileSync(s,"utf8"));e.status=t,e.current_task=n,e.updated_at=new Date().toISOString(),i().writeFileSync(s,JSON.stringify(e,null,2))}}(e,"working",r),function(e,t,n,s){let r=a().join(u,"token_logs","performance.json"),o={timestamp:new Date().toISOString(),agentId:e,duration:t,inputChars:n,outputChars:s,estimatedTokens:Math.ceil((n+s)/4)},l=[];i().existsSync(r)&&(l=JSON.parse(i().readFileSync(r,"utf8"))),l.push(o),i().writeFileSync(r,JSON.stringify(l.slice(-100),null,2))}(e,y,n.length,m.length),{agentId:e,name:t.name,emoji:t.emoji,status:"working",output:m.substring(0,2e3),message:`${t.emoji} ${t.name} completed the task`,duration:y,cached:!!c}}catch(n){return i().unlinkSync(o),console.error(`Error spawning ${e}:`,n),{agentId:e,name:t.name,emoji:t.emoji,status:"error",error:n.message,output:n.stdout?.substring(0,1e3)||"No output"}}}function h(e){return!!g[e.toLowerCase()]}async function w(e,t,n){let r=t.includes(" ")?t:`0 */${parseInt(t)||1} * * *`;try{let t=(0,s.execSync)(`cd ${l} && openclaw cron add --name "${e}" --schedule "${r}" --message "${n}" --target isolated 2>&1`,{encoding:"utf8",timeout:3e4});return{success:!0,output:t}}catch(e){return{success:!1,error:e.message}}}function j(){let e=g.echo,t="Analyze dashboard performance",n=d(e,t).split(" ").length,s=m(e,t).split(" ").length,r=s-n;return{compressed:n,full:s,savings:r,percentage:Math.round(r/s*100)}}},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=8732);module.exports=n})();