"use strict";(()=>{var e={};e.id=99,e.ids=[99],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1282:e=>{e.exports=require("child_process")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8585:(e,t,n)=>{n.r(t),n.d(t,{config:()=>g,default:()=>S,routeModule:()=>w});var r={};n.r(r),n.d(r,{default:()=>f});var s=n(1802),a=n(7153),u=n(6249),i=n(2048),o=n.n(i),c=n(5315),l=n.n(c);let d="/home/ubuntu/.openclaw/workspace/agent-agency";async function f(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let e=await p(),n=await y(),r=await m(),s=await h(),a=await P();t.status(200).json({success:!0,timestamp:new Date().toISOString(),metrics:{cronJobs:e,tokenUsage:n,immuneStatus:r,recentWork:s,systemHealth:a}})}catch(e){t.status(500).json({error:e.message})}}async function p(){try{let{execSync:e}=n(1282),t=e('openclaw cron list --json 2>/dev/null || echo "[]"',{encoding:"utf8",timeout:5e3});return JSON.parse(t)}catch{return[]}}async function y(){let e=l().join(d,"token_logs",`${new Date().toISOString().split("T")[0]}.json`);if(!o().existsSync(e))return{today:0,sessions:[]};try{let t=JSON.parse(o().readFileSync(e,"utf8"));return{today:t.reduce((e,t)=>e+(t.totalTokens||0),0),sessions:t.slice(-10)}}catch{return{today:0,sessions:[]}}}async function m(){let e=l().join(d,"immune-system","status.json");if(!o().existsSync(e))return{lastCheck:null,status:"unknown",alerts:[]};try{return JSON.parse(o().readFileSync(e,"utf8"))}catch{return{lastCheck:null,status:"unknown",alerts:[]}}}async function h(){let e=l().join(d,"work_tracker.json");if(!o().existsSync(e))return[];try{return JSON.parse(o().readFileSync(e,"utf8")).slice(-20)}catch{return[]}}async function P(){let e=l().join(d,"system_health.json");if(!o().existsSync(e))return{status:"unknown",lastCheck:null,diskUsage:null,memoryUsage:null};try{return JSON.parse(o().readFileSync(e,"utf8"))}catch{return{status:"unknown",lastCheck:null,diskUsage:null,memoryUsage:null}}}let S=(0,u.l)(r,"default"),g=(0,u.l)(r,"config"),w=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/metrics",pathname:"/api/metrics",bundlePath:"",filename:""},userland:r})},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=8585);module.exports=n})();